<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft Edge Multi Portable</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
            overflow: hidden;
        }

        .header {
            background: #333;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 0;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }

        .section h2.versions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section h2.versions::before {
            content: "üì¶";
            font-size: 1.1rem;
        }

        .version-list {
            list-style: none;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .version-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .version-item:last-child {
            border-bottom: none;
        }

        .version-info h3 {
            font-size: 1rem;
            margin-bottom: 3px;
            color: #333;
        }

        .version-status {
            font-size: 0.85rem;
            color: #666;
        }

        .version-number {
            font-family: 'Consolas', 'Monaco', monospace;
            background: white;
            padding: 6px 12px;
            font-size: 0.9rem;
            color: #495057;
        }

        .version-number.unavailable {
            background: transparent;
            color: #999;
            cursor: default;
        }

        .version-number.unavailable:hover {
            background: transparent;
            color: #999;
        }

        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .status-current { background: #28a745; }
        .status-outdated { background: #ffc107; }
        .status-unavailable { background: #dc3545; }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }

        .error {
            background: #f5f5f5;
            color: #333;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #ddd;
            text-align: center;
        }

        .notice {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .notice h3 {
            color: #333;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .notice p, .notice ul {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .notice ul {
            padding-left: 20px;
        }

        .features {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
        }

        .features ul {
            list-style: none;
            padding-left: 0;
        }

        .features li {
            padding: 3px 0;
            position: relative;
            padding-left: 20px;
        }

        .features li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 0;
            color: #333;
            font-weight: bold;
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .content {
                padding: 20px;
            }

            .github-footer {
                padding: 10px 20px;
            }

            .version-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Microsoft Edge Multi Portable</h1>
            <p>Download the pre-built release, extract, and start using immediately.</p>
        </header>

        <div class="content">
            <div class="section">
                <h2 class="versions">Available Portable Versions</h2>
                <div id="versions-content">
                    <div class="loading">Loading latest versions...</div>
                </div>
            </div>

            <div class="section">
                <h2>‚≠ê Features</h2>
                <div class="features">
                    <ul>
                        <li>All channels: Stable, Beta, Developer, Canary</li>
                        <li>Windows x64 architecture only</li>
                        <li>No installation required - extract and run</li>
                        <li>Pre-configured for portable usage</li>
                        <li>Keeps all data in local folder</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <h2>üìÅ Files and Their Purposes</h2>
                <div class="notice">
                    <ul>
                        <li><strong>chrome++.ini</strong>: configuration file for Chrome++</li>
                        <li><strong>debloater.reg</strong>: removes unnecessary features from Microsoft Edge</li>
                        <li><strong>default-apps-multi-profile.bat</strong>: sets the browser as the default application</li>
                        <li><strong>update.bat</strong>: updates to the latest version</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <h2>‚ö†Ô∏è Important Notice</h2>
                <div class="notice">
                    <h3>Microsoft Defender Antivirus Warning</h3>
                    <p>Due to the way Microsoft Edge is bypassed to run as a portable app, Microsoft Defender Antivirus may falsely flag it as a trojan.</p>
                    <p><strong>Solution:</strong> Allow/whitelist the file and wait for Microsoft Defender's definitions to update and remove the false positive.</p>
                </div>
            </div>

            <p style="text-align: center; margin-top: 20px; font-size: 0.9rem;">
                <a href="https://github.com/bibicadotnet/microsoft-edge-multi-portable" target="_blank" style="color: #666; text-decoration: none;">View on GitHub</a>
            </p>
        </div>
    </div>

    <script>
        const GITHUB_API_BASE = 'https://api.github.com/repos/bibicadotnet/microsoft-edge-multi-portable';
        
        function compareVersions(v1, v2) {
            const parts1 = v1.split('.').map(Number);
            const parts2 = v2.split('.').map(Number);
            
            for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {
                const part1 = parts1[i] || 0;
                const part2 = parts2[i] || 0;
                
                if (part1 > part2) return 1;
                if (part1 < part2) return -1;
            }
            return 0;
        }

        async function getOfficialVersions() {
            try {
                // S·ª≠ d·ª•ng CORS proxy
                const response = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://edgeupdates.microsoft.com/api/products'));
                if (!response.ok) throw new Error('API response not ok');
                
                const data = await response.json();
                const products = JSON.parse(data.contents);
                const versions = {};
                
                const channelMap = {
                    'Stable': 'stable',
                    'Beta': 'beta', 
                    'Dev': 'dev',
                    'Canary': 'canary'
                };
                
                for (const product of products) {
                    const channelKey = channelMap[product.Product];
                    if (channelKey && product.Releases) {
                        const windowsReleases = product.Releases.filter(r => 
                            r.Platform === 'Windows' && r.Architecture === 'x64'
                        );
                        
                        if (windowsReleases.length > 0) {
                            const latest = windowsReleases.sort((a, b) => 
                                new Date(b.PublishedTime) - new Date(a.PublishedTime)
                            )[0];
                            versions[channelKey] = latest.ProductVersion;
                        }
                    }
                }
                
                console.log('Official versions:', versions);
                return versions;
            } catch (error) {
                console.warn('Failed to fetch official versions:', error);
                // Fallback v·ªõi version m·∫´u ƒë·ªÉ test
                const fallbackVersions = {
                    'stable': '131.0.2903.112',
                    'beta': '132.0.2957.55', 
                    'dev': '141.0.3500.0',
                    'canary': '141.0.3508.0'
                };
                console.log('Using fallback versions:', fallbackVersions);
                return fallbackVersions;
            }
        }
        
        async function loadVersions() {
            const versionsContent = document.getElementById('versions-content');
            versionsContent.innerHTML = '<div class="loading">Loading latest versions...</div>';
            
            try {
                // Fetch GitHub releases
                const githubResponse = await fetch(`${GITHUB_API_BASE}/releases`);
                if (!githubResponse.ok) throw new Error('Failed to fetch releases');
                
                const releases = await githubResponse.json();
                
                // Try to get official versions (optional)
                const officialVersions = await getOfficialVersions();
                
                const channels = [
                    { key: 'stable', name: 'Microsoft Edge Stable' },
                    { key: 'beta', name: 'Microsoft Edge Beta' },
                    { key: 'dev', name: 'Microsoft Edge Developer' },
                    { key: 'canary', name: 'Microsoft Edge Canary' }
                ];
                
                let html = '<ul class="version-list">';
                
                for (const channel of channels) {
                    const officialVersion = officialVersions[channel.key];
                    
				// Find portable release
				const portableReleases = releases
					.filter(release => release.tag_name.includes(`${channel.key}-portable-x64`))
					.map(release => {
						const versionMatch = release.tag_name.match(/x64_([0-9.]+)_/);
						return {
							...release,
							parsedVersion: versionMatch ? versionMatch[1] : '0.0.0'
						};
					})
					.sort((a, b) => compareVersions(b.parsedVersion, a.parsedVersion));

				const portableRelease = portableReleases[0];
                    
                    let portableVersion = null;
                    let downloadUrl = null;
                    let status = 'unavailable';
                    let statusText = 'Not available yet';
                    
                    if (portableRelease) {
                        const versionMatch = portableRelease.tag_name.match(/x64_([0-9.]+)_/);
                        portableVersion = versionMatch ? versionMatch[1] : null;
                        
                        // Find direct download link
                        const asset = portableRelease.assets && portableRelease.assets.find(asset => 
                            asset.name.endsWith('.zip')
                        );
                        downloadUrl = asset ? asset.browser_download_url : portableRelease.html_url;
                        
                        if (portableVersion && officialVersion) {
                            const comparison = compareVersions(portableVersion, officialVersion);
                            console.log(`Channel: ${channel.key}, Portable: ${portableVersion}, Official: ${officialVersion}, Comparison: ${comparison}`);
                            
                            if (comparison === 0) {
                                status = 'current';
                                statusText = 'Latest version available';
                            } else if (comparison < 0) {
                                status = 'outdated';
                                statusText = `Portable: ${portableVersion} | Official: ${officialVersion} (newer available)`;
                            } else {
                                status = 'current';
                                statusText = 'Latest version available';
                            }
                        } else if (portableVersion) {
                            // C√≥ portable version nh∆∞ng kh√¥ng l·∫•y ƒë∆∞·ª£c official version
                            status = 'current';
                            statusText = 'Available for download';
                        } else {
                            // C√≥ release nh∆∞ng kh√¥ng parse ƒë∆∞·ª£c version
                            status = 'current';
                            statusText = 'Available for download';
                        }
                    } else if (officialVersion) {
                        // C√≥ official version nh∆∞ng ch∆∞a c√≥ portable release
                        status = 'unavailable';
                        statusText = `Official: ${officialVersion} - Portable not yet available`;
                    }
                    
                    html += `
                        <li class="version-item">
                            <div class="version-info">
                                <h3>${channel.name}</h3>
                                <div class="version-status">
                                    <span class="status-dot status-${status}"></span>
                                    ${statusText}
                                </div>
                            </div>
                            ${portableVersion && downloadUrl ? 
                                `<a href="${downloadUrl}" class="version-number" target="_blank">${portableVersion}</a>` :
                                `<span class="version-number unavailable">Not Available</span>`
                            }
                        </li>
                    `;
                }
                
                html += '</ul>';
                versionsContent.innerHTML = html;
                
            } catch (error) {
                versionsContent.innerHTML = `
                    <div class="error">
                        Unable to load versions. Please visit the GitHub repository directly.
                    </div>
                `;
                console.error('Error loading versions:', error);
            }
        }
        
        // Load versions when page loads
        document.addEventListener('DOMContentLoaded', loadVersions);
    </script>
</body>
</html>
